import Analytics = require("../common/analytics");
import IBusiness = require("../business/iBusiness");
import IService  = require("./iService");
import Strings   = require("../strings");
import $inject 	 = require("../core/inject");

declare var globalAnalytics: Analytics, strings: Strings;

/**
 * Responsible for integrating the outside's requests for Buses with the business logics
 * @class SearchService
 */
class SearchService implements IService {
	
	public constructor(private business: IBusiness = $inject("business/searchBusiness"), private mustLimit?: boolean, private analytics?: Analytics) {
			if(!this.mustLimit) this.mustLimit = true;
			if(!this.analytics) this.analytics = globalAnalytics;
		}
	
	/**
	 * Gets the Buses given a line or a list of, a bus order or a list of. If the search
	 * params are not given, gets all buses latest data.
	 * 
	 * @param {string} lines/orders
	 * @return {Bus[]}
	 */
	public retrieve(userAgent: string, line?: string): any {
		if(line===undefined) return this.business.retrieve();
		else {
			var data: string[] = this.processData(line);
			var flag: any = Strings.analytics;
			this.analytics.trackEvent(flag.event.restHit, flag.label.rest, userAgent, (error, response)=>{});
			data.forEach((line)=>{
				this.analytics.trackEvent(flag.event.restHit, flag.label.busCode, line, (error, response)=>{});
			}, this);
			return this.business.retrieve(data, this.mustLimit);
		}
	}
	
	/**
	 * Given a data, recognizes its structure and returns the corresponding
	 * @param {string} data
	 * @return {string[]}
	 */
	private processData(data: string): string[] {
		var aux = data.toUpperCase();
		switch(aux){
			case "TRANSCARIOCA":
				this.mustLimit = false;
				return ["301", "302", "303", "305", "306", "309", "314", "315", "316", "317","318", "331", "332", "337", "338", "339", "341", "343", "345", "346",	"348", "352", "353", "354", "360", "361", "363", "368", "371", "380", "382", "390", "501", "502", "504", "505", "525", "550", "555", "556", "557", "565", "600", "601", "607", "610", "611", "613", "614", "636", "651", "652", "667", "678", "686", "690", "691", "692", "693", "702", "709", "712", "721", "723", "734", "766", "774", "775", "781", "782", "783", "800", "805", "806", "808", "809", "810", "815", "816", "817", "818", "823", "827", "829", "831", "832", "844", "856", "859", "860", "861", "862", "863", "865", "875", "878", "880", "882", "886", "887", "888", "889", "890", "897", "899", "900", "931", "932", "940", "954", "955", "957", "959", "963", "964", "991", "2018", "2110", "2111", "2112", "2114", "2115", "2329", "2330", "2333", "2345", "2346", "2918", "LECD10", "LECD7", "SE614", "SE832", "SP306", "SP316", "SP341", "SP363", "LECD13", "SV2333", "SV363", "SV390", "SP343", "SV774", "SVA2345", "SVB2345", "SP352", "SP899", "SV301", "SV878"];
			case "SANTA CRUZ":
				this.mustLimit = false;
				return ["300", "358", "364", "365", "366", "367", "369", "370", "379", "383", "388", "389", "391", "392", "393", "394", "395", "396", "397", "398", "684", "689", "731", "737", "738", "739", "741", "742", "743", "744", "745", "746", "750", "751", "752", "754", "756", "759", "767", "769", "770", "771", "777", "784", "786", "790", "794", "801", "802", "803", "804", "807", "811", "812", "813", "814", "819", "821", "822", "824", "825", "826", "828", "830", "833", "834", "835", "836", "837", "838", "839", "840", "841", "842", "843", "845", "846", "847", "848", "849", "850", "851", "852", "853", "854", "855", "857", "858", "864", "866", "867", "868", "869", "870", "871", "872",  "873", "874", "876", "879", "881",  "883", "884", "885", "891", "892", "893",	"894", "895", "896", "898", "918", "923", "926", "933", "936", "2303", "2304", "2307", "2308", "2309", "2310", "2331", "2332", "2334",	"2335",	 "2336", "2337", "2338", "2339", "2381", "2801", "2802", "2803", "2804", "LECD12", "LECD14", "LECD15", "LECD17", "LECD8", "SE867", "SN300", "SN392", "SN393", "SN397", "SN398", "SN689", "SN737", "SN741", "SN744", "SN745", "SN777", "SN786", "SN803", "SN838", "SN839", "SN840", "SN841", "SN846", "SN850", "SN854", "SN867", "SN898", "SP366", "SP383", "SP393", "SP397", "SP398", "SP803", "SP838", "SP850", "SP884", "SPA854","SPB854", "SR300", "SR393", "SR397", "SR398","SV233", "SV233", "SV238", "SV300","SV367","SV379","SV389","SV394","SV395","SV777","SV790","SV841", "SV843", "SV853", "SV866", "SV870"];
			case "INTERSUL":
				this.mustLimit = false;
				return ["006", "007", "010", "011", "014", "016", "107", "110", "111", "119", "120", "121", "122", "123", "124", "125", "126", "127", "128", "129", "132", "133", "136", "143", "154", "155", "157", "161", "162", "170", "172", "173", "177", "178", "180", "181", "183", "184", "190", "201", "202", "209", "210", "217", "220", "222", "226", "229", "401", "409", "410", "411", "413", "415", "416", "420", "421", "422", "423", "425", "426", "432", "433", "434", "435", "436", "438", "439", "440", "441", "442", "443", "444", "445", "448", "460", "461", "462", "463", "464", "472", "473", "474", "475", "476", "503", "507", "511", "512", "513", "535", "537", "538", "539", "548", "569", "570", "573", "574", "580", "583", "584", "602", "603", "605", "608", "626", "2014", "2015", "2017", "2203", "SE006", "SE014", "SN006", "SN538", "SN539", "SP538", "SP539", "SV007"];
			case "INTERNORTE":
				this.mustLimit = false;
				return ["232", "238", "239", "247", "249", "254", "265", "277", "292", "296", "298", "310", "311", "312", "313", "320", "321", "322", "323", "324", "325", "326", "327", "328", "329", "330", "334", "335", "342", "344", "349", "350", "351", "355", "362", "372", "373", "374", "375", "376", "377", "378", "381", "384", "385", "386", "399", "402", "404", "405", "454", "455", "456", "457", "458", "459", "480", "481", "483", "484", "485", "486", "497", "498", "606", "609", "615", "616", "621", "622", "623", "624", "625", "627", "628", "629", "630", "634", "635", "638", "639", "650", "653", "661", "662", "663", "665", "669", "673", "676", "679", "680", "685", "687", "688", "696", "711", "725", "727", "773", "778", "779", "793", "795", "901", "905", "906", "908", "910", "911", "912", "913", "914", "915", "917", "919", "920", "922", "924", "925", "928", "934", "935", "942", "944", "945", "946", "947", "950", "951", "956", "2101", "2145", "2251", "2295", "2302", "2305", "2342", "2343", "2344", "LECD2", "SE232", "SP247", "SP249", "SP254", "SP292", "SP311", "SP312", "SP322", "SP326", "SP334", "SP378", "SP386", "SP404", "SP455", "SP485", "SP498", "SP687", "SP910", "SPA232", "SPA298", "SPA349", "SPA350", "SPA355", "SPA362", "SPA384", "SPA484", "SPB232", "SPB298", "SPB349", "SPB350", "SPB355", "SPB362", "SPB384", "SPB484", "SPC298", "SPC349", "SPC355", "SPC362", "SPC384", "SPC484", "SPD355", "SR335", "SR342", "SR349", "SR350", "SR355", "SR362", "SR378", "SR385", "SV232", "SV249", "SV322", "SV328", "SV335", "SV342", "SV376", "SV385", "SV498", "SV606", "SV669", "SV685", "SV779", "SV901", "SV908", "SV917", "SV919", "SV920", "SV928", "SV942", "SV944", "SVA324", "SVA326", "SVA665", "SVA696", "SVA905", "SVB324", "SVB326", "SVB665", "SVB696", "SVB905", "SVC905", "LECD18"];
			default:
				return data.split(",");
		}
	}
	
	/**
	 * Not implemented.
	 * @return {void}
	 */
	public delete(): any {}
	
	/**
	 * Not implemented.
	 * @return {void}
	 */
	public create(): any {}
	
	/**
	 * Not implemented.
	 * @return {void}
	 */
	public update(): any {}
}
export = SearchService;